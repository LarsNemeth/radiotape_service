(function(e,t){e("services/streams",[],function(){var e="radiotape.services.streams";return t.module(e,[]).factory("Streams",["$resource","$rootScope",function(e,t){return e(t.apiBaseUrl+"streams",{},{get:{method:"GET",params:{},isArray:!0}})}]),e})})(define,angular),function(e,t){e("services/playlist",[],function(){var e="radiotape.services.playlist";return t.module(e,[]).factory("Playlist",["$resource","$rootScope",function(e,t){return e(t.apiBaseUrl+"streams/:streamId/playlist/",{},{get:{method:"GET",params:{},isArray:!0}})}]),e})}(define,angular),function(e,t){e("services/preset",[],function(){var e="radiotape.services.streams.preset";return t.module(e,[]).factory("Preset",["$resource","$rootScope",function(e,t){return e(t.apiBaseUrl+"streams/:streamId/preset",{streamId:"@streamId"},{changePreset:{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}})}]),e})}(define,angular),function(e){e("controllers/stationCtrl",[],function(){function t(e,t,n,r,i,s){n.get(function(n){t.activePresetId=n[0].preset,t.streamId=n[0]._id,t.logo=n[0].logo,e.activePresetId=t.activePresetId,e.streams=n[0].availablePresets,e.audio.src===""&&(e.audio.src=n[0].streamUrl.substring(0,n[0].streamUrl.length-4),e.audio.setAttribute("type","audio/mpeg")),t.activePresetId=="AUTO"?e.autoPresetMode=!0:e.autoPresetMode=!1;var r=function(e){return(parseInt(e.substr(0,2))*60+parseInt(e.substr(3,2)))*60+parseInt(e.substr(6,2))},i=new Date,o=(i.getHours()*60+i.getMinutes())*60+i.getSeconds(),u=s("orderBy")(s("filter")(n[0].schedule,{day:i.getDay()}),"start"),a=s("filter")(u,function(e){if((r(e.end)>o||e.end==="00:00:00")&&(r(e.start)<=o||e.start==="00:00:00"))return!0})[0];if(a!==undefined){var f=s("orderBy")(s("filter")(u,function(e){if(r(e.end)<=r(a.start))return!0}),"end",!0)[0],l=s("orderBy")(s("filter")(u,function(e){if(r(e.start)>=r(a.end))return!0}),"start")[0];if(a.start==="00:00:00"){var c=(i.getDay()+6)%7;f=s("orderBy")(s("filter")(n[0].schedule,{day:c}),"start",!0)[0]}if(a.end==="00:00:00"){var h=(i.getDay()+1)%7;f=s("orderBy")(s("filter")(n[0].schedule,{day:h}),"start")[0]}e.scheduleLastPreset=f.preset,e.scheduleLastPresetTime=f.start.substr(0,5),e.scheduleCurrentPreset=a.preset,e.scheduleCurrentPresetTime=a.start.substr(0,5),e.scheduleNextPreset=l.preset,e.scheduleNextPresetTime=l.start.substr(0,5)}else e.scheduleCurrentPreset="nothing scheduled";e.streams.forEach(function(n){n._id===t.activePresetId&&(e.activePresetName=n.name,e.activePresetCover=n.imgLarge,e.imageIcon=n.imgIcon)})},function(e){console.log("could not load stations (/streams GET)"),e.status&&(r.remove("authinfo"),i.path("/info"))})}var e=function(e,n,r,i,s,o,u,a){var f=document.querySelector("#blurCanvas"),l=f.getContext("2d");e.play=function(){e.playing=!0},e.scrollLeft=function(){angular.element(document.getElementById("channel_list_scolling_container")).duScrollTo(angular.element(document.getElementById("channel_list_scolling_container")).duScrollLeft()+230,0,300).then(function(){})},e.scrollRight=function(){angular.element(document.getElementById("channel_list_scolling_container")).duScrollTo(angular.element(document.getElementById("channel_list_scolling_container")).duScrollLeft()-230,0,300).then(function(){})},e.coverUrl="",e.activePresetCover="",e.autoPresetMode=!1,e.autoPresetModeMayExit=!1,e.playing=!1,e.audio=document.createElement("audio"),e.audio.id="audiostream",angular.element(document.getElementsByTagName("body")).append(e.audio),n.audio=e.audio,e.channelSwitchPending=!1,e.newChannelId="",t(e,n,r,o,i,u),function c(){t(e,n,r,o,i,u),a(c,15e4)}(),e.cancelSwitch=function(){e.channelSwitchPending=!1},e.toggleAutoPresetMode=function(){e.autoPresetMode?e.autoPresetModeMayExit=!e.autoPresetModeMayExit:(e.channelSwitchNewName="auto mode",e.channelSwitchToPresetId="AUTO",e.channelSwitchPending=!0,e.autoPresetMode=!0,e.activePresetId=e.channelSwitchToPresetId)},e.$on("toggleAutoPresetMode",function(t){e.toggleAutoPresetMode(),i.path("/")}),e.$on("changePreset",function(t,n){e.channelSwitchNewName=n.name,e.channelSwitchToPresetId=n._id,e.channelSwitchPending=!0,e.autoPresetModeMayExit=!1,i.path("/"),e.autoPresetModeMayExit=!1,e.autoPresetMode=!1,e.activePresetId=e.channelSwitchToPresetId}),e.$on("coverChange",function(t,n){function r(e,t,n,r,i,s,o,u){arguments.length===2&&(n=r=0,i=e.canvas.width,s=e.canvas.height),o=o?o:.5,u=u?u:.5,o<0&&(o=0),u<0&&(u=0),o>1&&(o=1),u>1&&(u=1);var a=t.width,f=t.height,l=Math.min(i/a,s/f),c=a*l,h=f*l,p,d,v,m,g=1;c<i&&(g=i/c),h<s&&(g=s/h),c*=g,h*=g,v=a/(c/i),m=f/(h/s),p=(a-v)*o,d=(f-m)*u,p<0&&(p=0),d<0&&(d=0),v>a&&(v=a),m>f&&(m=f),e.drawImage(t,p,d,v,m,n,r,i,s)}function o(){r(i,this)}n===""?e.coverUrl=e.activePresetCover:e.coverUrl=n;var i=f.getContext("2d"),s=new Image;s.onload=o,s.src=e.coverUrl}),e.$on("updateTimeLeft",function(a,f){e.channelSwitchPending&&s.changePreset({streamId:n.streamId},"preset="+e.channelSwitchToPresetId,function(){e.channelSwitchPending=!1,t(e,n,r,o,i,u)}),f<0?(e.channelSwitchInSeconds=0,e.channelSwitchFormattedMinutes=0,e.channelSwitchFormattedSeconds=0,f<-1&&e.$broadcast("updateNowPlaying")):(e.channelSwitchInSeconds=f|0,e.channelSwitchFormattedMinutes=f/60|0,e.channelSwitchFormattedSeconds=f-e.channelSwitchFormattedMinutes*60|0,e.channelSwitchFormattedSeconds<10&&(e.channelSwitchFormattedSeconds="0"+e.channelSwitchFormattedSeconds))}),e.$on("getSchedule",function(t){var n={lastPreset:e.scheduleLastPreset,lastPresetTime:e.scheduleLastPresetTime,currentPreset:e.scheduleCurrentPreset,currentPresetTime:e.scheduleCurrentPresetTime,nextPreset:e.scheduleNextPreset,nextPresetTime:e.scheduleNextPresetTime};e.$broadcast("currentSchedule",n)})};return["$scope","$rootScope","Streams","$location","Preset","$cookieStore","$filter","$timeout",e]})}(define),function(e){e("controllers/stationInfoCtrl",[],function(){var e=function(e,t,n,r,i){e.preset="",e.imageURL="",e.imageIcon="",e.genre="...",e.$on("currentSchedule",function(t,n){e.schedule=n}),e.staticInfo=!0,e.presetId=n.id,r.get(function(t){e.title=t[0].name,console.log(t[0]),t[0].availablePresets.forEach(function(t){t._id==e.presetId&&(e.title=t.name,e.preset=t,e.description=t.description,e.imageURL=t.imgLarge,e.imageIcon=t.imgIcon,e.genre=t.title,e.staticInfo=!1)}),e.staticInfo===!0&&(e.preset="",e.imageURL="./assets/images/timetable_image.png",e.imageIcon="./assets/images/scheduler_pfeil.png",e.genre="Timetable",i(function(){e.$emit("getSchedule")}))},function(e){console.log("could not load stations (/streams GET)")}),e.changePreset=function(){e.$emit("changePreset",e.preset)},e.toggleAutoPresetMode=function(){e.$emit("toggleAutoPresetMode")}};return["$scope","$rootScope","$stateParams","Streams","$timeout",e]})}(define),function(e){e("controllers/playlistCtrl",[],function(){var e=function(e,t,n,r){e.title="playlist",r.get(function(r){t.streamId=r[0]._id,e.playlist=n.get({streamId:t.streamId})})};return["$scope","$rootScope","Playlist","Streams",e]})}(define),function(e){e("controllers/nowPlayingCtrl",[],function(){function t(e,t,n,r,i,s){var o=i.get(function(e){n.streamId=e[0]._id,t.streamId=n.streamId,e[0].availablePresets.forEach(function(e){e._id===t.streamId&&(t.title=e.name,t.preset=e,t.description=e.description,t.imageURL=e.imgLarge,t.imageIcon=e.imgIcon,t.genre=e.title)}),r.get({streamId:n.streamId},function(e){t.title=e[0].Title,t.artist=e[0].Artist,t.album=e[0].Album,t.coverUrl=e[0].Cover,t.$emit("coverChange",t.coverUrl),t.duration=e[0].Duration,t.percent=0,t.startSecondsSince1970=(new Date(e[0].Time)).getTime()/1e3})})}function n(e){e.progressInSeconds=new Date/1e3-e.startSecondsSince1970}var e=function(e,r,i,s,o,u,a){r.title="now playing",r.timepassed=50,t(e,r,i,s,u,a),r.$on("updateNowPlaying",function(){t(e,r,i,s,u,a)}),function f(){n(r),r.percent=r.progressInSeconds/r.duration*100|0,r.$emit("updateTimeLeft",r.duration-r.progressInSeconds),o(f,1e3)}()};return["$q","$scope","$rootScope","Playlist","$timeout","Streams","Preset",e]})}(define),function(e){e("controllers/infoCtrl",[],function(){function t(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="",r,i,s="",o,u,a,f="",l=0;do r=e.charCodeAt(l++),i=e.charCodeAt(l++),s=e.charCodeAt(l++),o=r>>2,u=(r&3)<<4|i>>4,a=(i&15)<<2|s>>6,f=s&63,isNaN(i)?a=f=64:isNaN(s)&&(f=64),n=n+t.charAt(o)+t.charAt(u)+t.charAt(a)+t.charAt(f),r=i=s="",o=u=a=f="";while(l<e.length);return n}var e=function(e,n,r,i,s,o,u){e.$emit("coverChange","./assets/images/cover-images/Headphones.jpg"),o(function(){r.authinfo!==undefined&&(i.path("/"),e.$apply(),s.location.reload())}),e.login=function(){r.authinfo=t(e.username+":"+e.password),i.path("/"),e.$apply(),s.location.reload()}};return["$scope","$rootScope","$cookies","$location","$window","$timeout","$cookieStore",e]})}(define),function(e){e("controllers/logoutCtrl",[],function(){var e=function(e,t,n,r,i){n.remove("authinfo"),r.path("/info"),e.$apply(),i.location.reload()};return["$scope","$rootScope","$cookieStore","$location","$window",e]})}(define),function(e){e("controllers/volumeCtrl",[],function(){var e=function(e,t){var n={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return n.Android()||n.BlackBerry()||n.iOS()||n.Opera()||n.Windows()}};n.any()&&(e.mobileDevice=!0),e.volume=75,t.audio.volume=e.volume/100,e.$watch("volume",function(e,n){t.audio.volume=e/100})};return["$scope","$rootScope",e]})}(define),function(e,t){e("controllers/controllers",["controllers/stationCtrl","controllers/stationInfoCtrl","controllers/playlistCtrl","controllers/nowPlayingCtrl","controllers/infoCtrl","controllers/logoutCtrl","controllers/volumeCtrl"],function(e,n,r,i,s,o,u){var a="radiotape.controllers";return t.module(a,[]).controller("StationCtrl",e).controller("StationInfoCtrl",n).controller("PlaylistCtrl",r).controller("InfoCtrl",s).controller("LogoutCtrl",o).controller("VolumeCtrl",u).controller("NowPlaylingCtrl",i),a})}(define,angular),function(e){e("main",["services/streams","services/playlist","services/preset","controllers/controllers"],function(e,t,n,r){var i,s="radiotape";return i=angular.module(s,["ui.router","ui.bootstrap","ngSanitize","ngResource","ngCookies","ui.slider","duScroll",r,e,n,t]).config(["$urlRouterProvider","$stateProvider","$httpProvider",function(e,t){e.when("","/info"),e.otherwise("/"),t.state("nowPlaying",{url:"/",templateUrl:"./assets/views/nowPlaying.tpl.html",controller:"NowPlaylingCtrl"}).state("stationInfo",{url:"/stationInfo/:id",templateUrl:"./assets/views/stationInfo.tpl.html",controller:"StationInfoCtrl"}).state("scheduleInfo",{url:"/scheduleInfo",templateUrl:"./assets/views/stationInfo.tpl.html",controller:"StationInfoCtrl"}).state("playlist",{url:"/playlist",templateUrl:"./assets/views/playlist.tpl.html",controller:"PlaylistCtrl"}).state("info",{url:"/info",templateUrl:"./assets/views/info.tpl.html",controller:"InfoCtrl"}).state("logout",{url:"/logout",template:"",controller:"LogoutCtrl"})}]).run(["$rootScope","$http","$cookies","$cookieStore",function(e,t,n){var r="";t.defaults.headers.common.Authorization="Basic "+n.authinfo,e.apiBaseUrl="https://backend.radiotape.fm/api/",r==="dev"&&(e.apiBaseUrl="https://localhost:8888/webArtig/radiotape/api/")}]),angular.bootstrap(document,[s]),i}),$("body").on("touchmove",function(e){$(".scrollable").has($(e.target)).length||e.preventDefault()});var t=window.innerHeight;$("#wrapper").css("height",t),$(window).resize(function(){var e=window.innerHeight;$("#wrapper").css("height",e)})}(define);